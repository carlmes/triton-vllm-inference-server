#!/bin/bash
# source /opt/app-root/etc/generate_container_user

set -e

# display usage
$STI_SCRIPTS_PATH/usage

# Download NVIDIA sample models from GitHub
cd ${MODEL_REPOSITORY:-$HOME} 
git clone https://github.com/triton-inference-server/server.git triton-inference-server
cd ${MODEL_REPOSITORY:-$HOME}/triton-inference-server/docs/examples
./fetch_models.sh

# ENTRYPOINT ["/opt/nvidia/nvidia_entrypoint.sh", "tritonserver", "--model-repository", "/triton-inference-server/docs/examples/model_repository"]
cd $HOME
tritonserver \
  --model-repository=${MODEL_REPOSITORY:-$HOME/triton-inference-server/docs/examples/model_repository} \
  --model-control-mode=poll \
  --repository-poll-secs=60